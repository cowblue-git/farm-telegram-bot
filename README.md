# Farm Telegram Bot

Telegram-бот фермы «Голубой Коровы» для приёма и обработки заявок на экскурсии.

Бот используется как основной операционный интерфейс между посетителями фермы и администратором: посетители оставляют заявки, администратор подтверждает или отклоняет их напрямую в Telegram.

---

## Текущий статус

На данный момент бот работает **в режиме записи на экскурсии**.

Поддержка сезонных мероприятий (например, новогодних) **временно отключена**.  
В коде могут оставаться отдельные технические хвосты от этой логики — они **не влияют на работоспособность** и будут удалены на следующем этапе вместе с переходом на автоматический деплой через Git.

---

## Функциональность

### Для посетителей
- запись на экскурсию через пошаговый диалог;
- ввод имени, даты, времени, количества гостей и контакта;
- получение уведомления о подтверждении или отклонении заявки.

### Для администратора
- получение новых заявок в Telegram;
- подтверждение или отклонение заявок через inline-кнопки;
- автоматическое уведомление пользователя о статусе заявки.

---

## Временно отключено

- сезонные и разовые мероприятия (например, новогодние);
- сводка по мероприятиям;
- автоматическое управление вместимостью мероприятий.

Эта функциональность будет возвращаться **модульно**, без влияния на экскурсионный поток.

---

## Архитектура

- бот реализован как **state-machine**;
- все пользовательские сценарии проходят через состояния (`session.step`);
- подтверждение и отклонение заявок — только через администратора;
- хранилище данных — Cloudflare KV;
- бот развёрнут в Cloudflare Workers.

**Git-репозиторий является source of truth.**  
Любые изменения должны фиксироваться через Git.  
Ручные правки в Cloudflare допустимы только для диагностики.
___

## Deployment (Cloudflare Workers)

Проект использует Git → Cloudflare Workers Builds (push → deploy).

### Источник конфигурации
- `wrangler.toml` — единый источник правды для:
  - entrypoint (`main`)
  - KV bindings
  - vars (ADMIN_USER_ID, ADMIN_CHAT_ID)
- `BOT_TOKEN` хранится как **Cloudflare Secret**.

### Важно
- Не использовать ручной деплой через Dashboard для production.
- Не редактировать bindings вручную в Dashboard — только через `wrangler.toml`.
- Деплой выполняется командой:
  ```bash
  npx wrangler deploy --config wrangler.toml

---

NY legacy удалён и события будут возвращены модульно.

Следующий этап развития:
- дальнейшее упрощение и модульность кода.

---

## Назначение репозитория

Этот репозиторий:
- фиксирует рабочее состояние бота;
- используется как база для дальнейшего развития;
- служит источником контекста для работы с ИИ и автоматизации.

